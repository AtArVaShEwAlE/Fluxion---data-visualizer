{% extends "base.html" %}

{% block title %}My Charts - Fluxion{% endblock %}

{% block content %}
<div class="container">
    <!-- Page Header -->
    <div class="page-header">
        <h1> My Charts</h1>
        <p>View and manage your saved visualizations</p>
    </div>

    <!-- Charts Grid -->
    {% if charts %}
        <div class="charts-grid">
            {% for chart in charts %}
                <div class="chart-card">
                    <div class="chart-card-body">
                        <div>
                            {% if chart.chart_type == 'bar' %}<div class="icon-lg"><svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.2857142857142858" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chart-bar-big-icon lucide-chart-bar-big"><path d="M3 3v16a2 2 0 0 0 2 2h16"/><rect x="7" y="13" width="9" height="4" rx="1"/><rect x="7" y="5" width="12" height="4" rx="1"/></svg></div>
                            {% elif chart.chart_type == 'line' %}<div class="icon-lg"><svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.2857142857142858" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chart-line-icon lucide-chart-line"><path d="M3 3v16a2 2 0 0 0 2 2h16"/><path d="m19 9-5 5-4-4-3 3"/></svg></div>
                            {% elif chart.chart_type == 'pie' %}<div class="icon-lg"><svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.2857142857142858" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chart-pie-icon lucide-chart-pie"><path d="M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z"/><path d="M21.21 15.89A10 10 0 1 1 8 2.83"/></svg></div>
                            {% elif chart.chart_type == 'scatter' %}<div class="icon-lg"><svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.2857142857142858" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chart-scatter-icon lucide-chart-scatter"><circle cx="7.5" cy="7.5" r=".5" fill="currentColor"/><circle cx="18.5" cy="5.5" r=".5" fill="currentColor"/><circle cx="11.5" cy="11.5" r=".5" fill="currentColor"/><circle cx="7.5" cy="16.5" r=".5" fill="currentColor"/><circle cx="17.5" cy="14.5" r=".5" fill="currentColor"/><path d="M3 3v16a2 2 0 0 0 2 2h16"/></svg></div>
                            {% endif %}
                        </div>
                        <h3 class="chart-title">{{ chart.title }}</h3>
                        <div class="chart-meta">
                            <span class="chart-date">{{ chart.created_at.strftime('%b %d, %Y at %I:%M %p') }}</span>
                        </div>
                    </div>
                    <div class="chart-card-footer">
                        <button class="btn btn-primary btn-sm" onclick="viewChartModal({{ chart.id }})">
                            ğŸ‘ï¸ View Chart
                        </button>
                        <button class="btn btn-danger btn-sm" onclick="deleteChart({{ chart.id }}, {{ chart.title|tojson }})">
                            ğŸ—‘ï¸ Delete
                        </button>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <!-- Empty State -->
        <div class="card">
            <div class="empty-state">
                <div class="empty-icon">ğŸ“Š</div>
                <h3>No Charts Yet</h3>
                <p>You haven't created any charts yet. Upload a dataset and create your first visualization!</p>
                <div class="empty-actions">
                    <a href="{{ url_for('dashboard') }}" class="btn btn-primary">
                         Upload Dataset
                    </a>
                    <a href="{{ url_for('create_chart') }}" class="btn btn-secondary">
                         Create Chart
                    </a>
                </div>
            </div>
        </div>
    {% endif %}
</div>

<!-- Chart Modal -->
<div class="modal" id="chartModal">
    <div class="modal-overlay" onclick="closeChartModal()"></div>
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="modalChartTitle">Chart Title</h2>
            <button class="modal-close" onclick="closeChartModal()"></button>
        </div>
        <div class="modal-body">
            <div class="modal-chart-container">
                <canvas id="modalChartCanvas"></canvas>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeChartModal()">Close</button>
            <button class="btn btn-secondary" id="shareChartBtn"> Share</button>
            <button class="btn btn-secondary" id="downloadChartPNG"> PNG</button>
            <button class="btn btn-secondary" id="downloadChartPDF"> PDF</button>
            <button class="btn btn-primary" id="modalEditBtn"> Edit</button>
        </div>
    </div>
</div>

<!-- Flash Messages -->
{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        <div class="flash-messages">
            {% for category, message in messages %}
                <div class="alert alert-{{ category }}">
                    {{ message }}
                    <button type="button" class="alert-close" onclick="this.parentElement.style.display='none'">Ã—</button>
                </div>
            {% endfor %}
        </div>
    {% endif %}
{% endwith %}
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/charts.css') }}">
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{{ url_for('static', filename='js/charts.js') }}"></script>
{% endblock %}