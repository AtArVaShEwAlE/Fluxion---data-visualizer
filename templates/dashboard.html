{% extends "base.html" %}

{% block title %}Dashboard - Fluxion{% endblock %}

{% block content %}
<div class="container">
    <!-- Page Header -->
    <div class="page-header">
        <h1>Dashboard</h1>
        <p>Upload and manage your datasets</p>
    </div>

    <!-- Compact Upload Section -->
    <div class="card upload-card-compact">
        <div class="upload-area-compact" id="uploadArea">
            <div class="upload-content-compact">
                <div class="upload-icon-compact">
                    <!-- ICON: Upload/Folder Icon (e.g., lucide-upload or fa-folder-open) -->
                    <svg class="icon icon-xl" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.2857142857142858" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-download-icon lucide-download"><path d="M12 15V3"/><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><path d="m7 10 5 5 5-5"/></svg>
                </div>
                <h4>Upload Dataset</h4>
                <p>Drag & drop or <button class="upload-trigger" onclick="document.getElementById('fileInput').click()">browse</button></p>
                <div class="file-types">
                    <span class="file-type">CSV</span>
                    <span class="file-type">Excel</span>
                    <span class="file-type">Max 16MB</span>
                </div>
            </div>
            <input type="file" id="fileInput" accept=".csv,.xlsx,.xls" style="display: none;">
        </div>

        <!-- Loading State -->
        <div class="loading-state" id="loadingState" style="display: none;">
            <div class="loading-spinner"></div>
            <p>Processing your data...</p>
        </div>

        <!-- Error State -->
        <div class="error-state" id="errorState" style="display: none;">
            <div class="error-icon">
                <!-- ICON: Alert/Warning Icon (e.g., lucide-alert-triangle or fa-exclamation-triangle) -->
                <svg class="icon icon-lg" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.2857142857142858" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-x-icon lucide-circle-x"><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></svg>
            </div>
            <p id="errorMessage"></p>
        </div>
    </div>

    <!-- Data Preview Section -->
    <div class="card data-preview-card" id="dataPreview" style="display: none;">
        <div class="card-header">
            <h3 class="card-title" id="datasetTitle">
                <!-- ICON: File Icon (e.g., lucide-file-text or fa-file-alt) -->
                <svg class="icon icon-md" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.2857142857142858" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-chart-column-icon lucide-file-chart-column"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/><path d="M8 18v-1"/><path d="M12 18v-6"/><path d="M16 18v-3"/></svg>
                Dataset Preview
            </h3>
            <div class="dataset-actions">
                <button class="btn btn-primary" id="createChartBtn">
                    <!-- ICON: Chart Icon (e.g., lucide-bar-chart-2 or fa-chart-bar) -->
                    <svg class="icon icon-sm" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.2857142857142858" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chart-column-big-icon lucide-chart-column-big"><path d="M3 3v16a2 2 0 0 0 2 2h16"/><rect x="15" y="5" width="4" height="12" rx="1"/><rect x="7" y="8" width="4" height="9" rx="1"/></svg>
                    Create Chart
                </button>
            </div>
        </div>

        <!-- Dataset Stats -->
        <div class="dataset-stats">
            <div class="stat-item">
                <div class="stat-number" id="rowCount">0</div>
                <div class="stat-label">Rows</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="colCount">0</div>
                <div class="stat-label">Columns</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="fileSize">0KB</div>
                <div class="stat-label">Size</div>
            </div>
        </div>

        <!-- Data Table -->
        <div class="data-table-container">
            <table class="data-table" id="dataTable">
                <thead id="tableHead"></thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>

        <!-- Show More Button -->
        <div class="table-footer" style="display: none;" id="tableFooter">
            <button class="btn btn-secondary" id="showMoreBtn">
                Show More Rows
            </button>
        </div>
    </div>

    <!-- Recent Datasets Table -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">
                <!-- ICON: Database/Library Icon (e.g., lucide-database or fa-database) -->
                <svg class="icon icon-md" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.2857142857142858" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-book-text-icon lucide-book-text"><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20"/><path d="M8 11h8"/><path d="M8 7h6"/></svg>
                Recent Datasets
            </h3>
        </div>
        
        {% if recent_activity %}
            <div class="table-wrapper">
                <table class="datasets-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Rows</th>
                            <th>Columns</th>
                            <th>Uploaded</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for activity in recent_activity %}
                            <tr>
                                <td class="dataset-name">{{ activity.text.replace('Uploaded "', '').replace('"', '') }}</td>
                                <td>-</td>
                                <td>-</td>
                                <td class="dataset-time">{{ activity.time }}</td>
                                <td class="dataset-actions">
                                    <a href="{{ url_for('download_dataset', dataset_id=activity.id) }}" 
                                       class="btn-icon" 
                                       title="Download"
                                       download>
                                        <!-- ICON: Download Icon (e.g., lucide-download or fa-download) -->
                                        <svg class="icon icon-sm" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.2857142857142858" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-download-icon lucide-download"><path d="M12 15V3"/><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><path d="m7 10 5 5 5-5"/></svg>
                                    </a>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <div class="empty-state">
                <div class="empty-icon">
                    <!-- ICON: Chart/Analytics Icon (e.g., lucide-line-chart or fa-chart-area) -->
                    <svg class="icon icon-xl" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.2857142857142858" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chart-network-icon lucide-chart-network"><path d="m13.11 7.664 1.78 2.672"/><path d="m14.162 12.788-3.324 1.424"/><path d="m20 4-6.06 1.515"/><path d="M3 3v16a2 2 0 0 0 2 2h16"/><circle cx="12" cy="6" r="2"/><circle cx="16" cy="12" r="2"/><circle cx="9" cy="15" r="2"/></svg>
                </div>
                <h4>No datasets yet</h4>
                <p>Upload your first dataset to get started with data visualization</p>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}